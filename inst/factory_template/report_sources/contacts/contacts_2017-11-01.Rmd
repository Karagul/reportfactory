---
title: "Example of epidemiological contacts analysis"
author: Yourname Here
date: 2017-10-28
---

	
```{r options, include = FALSE, message = FALSE, warning = FALSE, error = FALSE}
library(knitr)
opts_chunk$set(collapse = TRUE, dev = c("png", "pdf"),
               fig.width = 8, fig.height = 6, dpi = 150)
```


# An example of epidemiological contact analysis

## Loading the data

We use `here` to locate the data stored in the `data/` folder, and `readxl` to
import data from the `.xlsx` files `PHM-EVD-linelist-2017-10-27.xlsx` and
`PHM-EVD-contacts-2017-10-27.xlsx`:
	
```{r read_data}
path_to_file <- here::here("data/linelists/PHM-EVD-linelist-2017-10-27.xlsx")
linelist <- readxl::read_xlsx(path_to_file)
linelist$onset <- as.Date(linelist$onset)

path_to_file <- here::here("data/contacts/PHM-EVD-contacts-2017-10-27.xlsx")
contacts <- readxl::read_xlsx(path_to_file)

```


We have a look at the data:
```{r read_files}
## linelist: one case per line
linelist

## contacts: one contact per line
contacts
```

## Visualising contacts using `epicontacts`

Contact tracing is often at the centre of an outbreak response. Using the
function `make_epicontacts` in the `epicontacts` package, we create a new
`epicontacts` object called `x`:
	      
```{r epicontacts}
library(epicontacts)
x <- make_epicontacts(linelist, contacts, directed = TRUE)
summary(x)
plot(x)
```  

We customize the graph using different node shapes for genders (see
`?vis_epicontacts` for more options):

```{r epicontacts_plot}
plot(x, node_shape = "sex", shapes = c(male = "male", female = "female"),
     selector = FALSE)

```
   
   
## Comparison of degree distribution 

Every contact has had exactly one exposure (in-degree):

```{r in_degree}
get_degree(x, "in")
```

But the case reproduction number (out-degree) is very heterogeneous
```{r out_degree}
get_degree(x, "out")
hist(get_degree(x, "out"), col = "#993333", border = "white",
     xlab = "Number of secondary cases",
     main = "Case reproduction number")
```


## Further description of contacts

We can look at gender patterns for contacts:

```{r pairwise}
## naive way
get_pairwise(x, "sex")

## building a contingency table
get_pairwise(x, "sex", table)
```

We can also compute the corresponding serial intervals:
```{r si}
si <- get_pairwise(x, "onset")
si
summary(si)
hist(si, col = "#2d5986", border = "white",
     xlab = "Time to secondary onset",
     main = "Serial interval from contacts")
```


