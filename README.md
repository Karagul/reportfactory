
# Report factory

The report factory is a lightweight infrastructure for compiling multiple `.Rmd`
reports stored in a dedicated folder, with naming conventions enforcing the date
of the report to be part of the file name. Each compiled report is rendered
using `rmarkdown::render`, and newly created files are stored into a dedicated,
time-stamped folder. Several functions facilitate this workflow, and allow to
compile all documents, or only the most recent reports.


## Components of the factory

- `report_sources`: `.Rmd` reports stored in the form
  `[report_base_name]_[yyyy-mm-dd].Rmd`; the date format is very important as it will
  be used for identifying the latest report version; *examples*:
  `sitrep_ebola_2018-06-13`, `incidence_curve_flu_2017-12-23`; **note** this
  folder should not contain any outputs of the `.Rmd` files!
  
- `report_outputs`: outputs of the reports, automatically generated by the
  factory, in dedicated folders named as
  `[report_base_name]_[yyyy-mm-dd]/compiled_[timestamp]/`

- `R/`, `DESCRIPTION`: part of the package structure (the factory itself is a
  package)


## Referring external files in reports

In the `Rmd` reports, all file paths should be referred to using `here()`,
assuming a path from the root directory.

### Where to put your data / how to call them?

We recommend storing all data in a `data/` folder in the root directory. When loading your data in the reports, make sure you use `here`, e.g.:


```r
my_data <- read.csv(here::here("data/linelist_2018-06-11.csv"))
```

### Where to put scripts / how to call them?

The rationale is the same as for data: store your scripts in a dedicated folder at the root of the project, e.g. `scripts/`, and source them from R using `here`, e.g.:


```r
source(here::here("script/custom_plot_functions.R"))
```

### Where to put other files / how to call them?

Follow the same idea as for data and scripts, but please avoid erasing existing
directories, especially those containing the package infrastructure (e.g. `R/`).



## Updating / compiling reports

- `list_reports()` will list available reports; we recommend adding `quiet =
  TRUE` to hide `rmarkdown::render` outputs

- `compile_report()` can be used to compile one specific report (name to be
  matched against the output of `list_reports()`
  
- `update_reports()` will by default compile all the latest version of each type
  of report; we recommend adding `quiet = TRUE` to hide `rmarkdown::render`
  outputs; adding `all = TRUE` will compile all reports (including old ones)
  
For instance, to compile the latest reports:

```r
devtools::load_all()
update_reports(quiet = TRUE)
```

to recompile all reports:


```r
devtools::load_all()
update_reports(all = TRUE, quiet = TRUE)
```

Alternatively, to compile the latest report one can execute the script
`./update_reports` on a linux environment.

Note that manual compilation of each document can still be done the usual way,
using `rmarkdown::render` in the source folder; if you do so, make sure you
remove all output files, as they would prevent further updates from the factory.


<br> <br>

**Copyright**: Thibaut Jombart, 2018
**Contact**: [thibautjombart@gmail.com](mailto:thibautjombart@gmail.com)
